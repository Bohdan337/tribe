{% load static %}
{% load tailwind_filters %}

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'src/styles.css' %}">
    <link rel="stylesheet" href="{% static 'src/input_field.css' %}">
    <title>Build Test</title>
</head>
<body class="bg-gray-900 min-h-screen">

    <!-- Header -->
    <header>
        <form method="post" action="{% url 'publish_test' test_id=test_data.id %}">
           {% csrf_token %}
            <div class="bg-gray-700 text-white p-3 flex justify-around items-center">
                <div class="flex">
                    <img src="{% static 'media/logo.png' %}"
                            class="h-11 me-2" alt="Logo"/>
                    <span class="self-center text-3xl font-semibold whitespace-nowrap dark:text-white">Tribe</span>
                </div>
                <div class="">
                    <a href="/" class=" text-white font-bold border border-white py-2.5 px-5 rounded mx-4" type="button">CANCEL</a>
                    <button type="submit" class="bg-gray-900 hover:bg-green-400 text-white font-bold py-2.5 px-5 rounded">PUBLISH THE TEST</button>
                </div>
            </div>
        </form>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto p-4 max-w-6xl" id="main-content">
        <div class="bg-blue-950 text-white shadow-md rounded-lg p-2">
            <h1 class="text-3xl font-bold mb-4 ml-3 mt-2">{{ test_data.name }}</h1>
            <div class="flex text-lg mb-2 ml-3 gap-5">
                <div class="flex items-center gap-0.5">
                    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1.2 em" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M824.2 699.9a301.55 301.55 0 0 0-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 0 0-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 0 0 8 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 0 1 612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 0 0 8-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 0 1-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 0 1 612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 0 1-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 0 0 8 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"></path></svg>
                    <span class="font-semibold">The test is publicly available</span>
                </div>
                <div class="flex items-center gap-1">
                    <svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 6C6 5.44772 6.44772 5 7 5H17C17.5523 5 18 5.44772 18 6C18 6.55228 17.5523 7 17 7H7C6.44771 7 6 6.55228 6 6Z" fill="currentColor"></path><path d="M6 10C6 9.44771 6.44772 9 7 9H17C17.5523 9 18 9.44771 18 10C18 10.5523 17.5523 11 17 11H7C6.44771 11 6 10.5523 6 10Z" fill="currentColor"></path><path d="M7 13C6.44772 13 6 13.4477 6 14C6 14.5523 6.44771 15 7 15H17C17.5523 15 18 14.5523 18 14C18 13.4477 17.5523 13 17 13H7Z" fill="currentColor"></path><path d="M6 18C6 17.4477 6.44772 17 7 17H11C11.5523 17 12 17.4477 12 18C12 18.5523 11.5523 19 11 19H7C6.44772 19 6 18.5523 6 18Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2 4C2 2.34315 3.34315 1 5 1H19C20.6569 1 22 2.34315 22 4V20C22 21.6569 20.6569 23 19 23H5C3.34315 23 2 21.6569 2 20V4ZM5 3H19C19.5523 3 20 3.44771 20 4V20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V4C4 3.44772 4.44771 3 5 3Z" fill="currentColor"></path></svg>
                    <span class="font-semibold">{{ test_data.subject.title }}</span>
                </div>
            </div>
        </div>

        <h2 class="text-xl text-gray-400 font-semibold my-4 ms-3.5">{{ questions|length }} questions  (total points: {{total_points}})</h2>

        <ul>
            {% for question in questions %}
            <li class="bg-blue-950 p-4 my-2 rounded-lg shadow-md flex justify-between">
                <div class="mr-4">
                    <p class="font-bold text-gray-300 shadow-md" style="padding: 0.25rem;">№ {{ forloop.counter}}</p>
                    <p class="text-sm text-gray-300 border rounded mt-2" style="padding: 0.25rem;">{{ question.points }} балів</p>
                </div>

                <div class="flex-1 ml-6">
                    <p class="font-bold text-xl text-gray-950">{{ question.text }}</p>
                    <div class="grid grid-cols-2 gap-4 mt-2">
                        {% for answer in question.answers %}
                        <div class="flex items-center mt-2">
                            <div class="mr-2 h-4 w-4 rounded-full {% if answer.is_correct %}bg-green-400{% else %}bg-gray-300{% endif %}"></div>
                            <span class="font-semibold text-gray-950">{{ answer.text }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="flex flex-col items-center ml-4 space-y-2">
                    <button class="overflow-hidden bg-gray-300 border border-gray-700 rounded-lg px-6 py-3 shadow-md transform transition-all duration-200 hover:scale-95 focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-opacity-50">
                        <span class="inset-0 flex items-center justify-center">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 14 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996 0 0 1 1.41 0l1.59 1.59c.39.39.39 1.02 0 1.41z"></path></svg>
                        </span>
                    </button>
                    <button class="overflow-hidden bg-gray-300 border border-gray-700 rounded-lg px-6 py-3 shadow-md transform transition-all duration-200 hover:scale-95 focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-opacity-50">
                        <span class="inset-0 flex items-center justify-center">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20,2H10C8.897,2,8,2.897,8,4v4H4c-1.103,0-2,0.897-2,2v10c0,1.103,0.897,2,2,2h10c1.103,0,2-0.897,2-2v-4h4 c1.103,0,2-0.897,2-2V4C22,2.897,21.103,2,20,2z M4,20V10h10l0.002,10H4z M20,14h-4v-4c0-1.103-0.897-2-2-2h-4V4h10V14z"></path><path d="M6 12H12V14H6zM6 16H12V18H6z"></path></svg>
                        </span>
                    </button>
                    <button class="overflow-hidden bg-gray-300 border border-gray-700 rounded-lg px-6 py-3 shadow-md transform transition-all duration-200 hover:scale-95 focus:outline-none focus:ring-2 focus:ring-gray-700 focus:ring-opacity-50">
                        <span class="inset-0 flex items-center justify-center">
                            <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M292.7 840h438.6l24.2-512h-487z"></path><path d="M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-504-72h304v72H360v-72zm371.3 656H292.7l-24.2-512h487l-24.2 512z"></path></svg>
                        </span>
                    </button>
                </div>
            </li>
        {% endfor %}
        </ul>

        <button id="add-question-button" class="bg-blue-950 hover:bg-green-400 text-white py-2 px-4 mt-4 rounded">Додати запитання</button>
        </div>
    </div>

    <div id="add-question-modal" class="hidden ontainer mx-auto p-4 max-w-6xl">
        <div class="bg-blue-950 text-white shadow-md rounded-lg p-2">
            <h1 class="text-3xl font-bold mb-4 ml-3 mt-2">Add a question</h1>
            <form id="add-question-form" method="post">
                {% csrf_token %}
                <div class="flex">
                    <div class="flex flex-col">
                        <label for="">Question type</label>
                        {{ question_form.question_type }}
                    </div>
                    <div class="flex flex-col">
                        <label for="">points</label>
                        {{ question_form.points }} 
                    </div>
                </div>

                <div class="flex flex-col">
                    <label for="">Question (required field)</label>
                    {{ question_form.text }}
                </div>

                {% for answer_form in answer_forms %}
                    <div class="flex flex-row">
                        {{ answer_form.as_p }}
                    </div>
                {% endfor %}
                <div class="flex justify-end">
                    <button type="button" id="cancel-add-question" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded mr-2">Відміна</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">Зберегти запитання</button>
               </div>
            </form>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#add-question-button').click(function() {
                $('#main-content').hide();
                $('#add-question-modal').show();
            });

            $('#cancel-add-question').click(function() {
                $('#add-question-modal').hide();
                $('#main-content').show();
            });

            $('#add-question-form').submit(function(event) {
                event.preventDefault();
                var form = $(this);
                var formData = form.serialize();
                $.ajax({
                    type: 'POST',
                    url: "{% url 'add_question' test_id=test_data.id %}",
                    data: formData,
                    success: function(response) {
                        if (response.success) {
                            location.reload();
                        } else {
                            alert("Error saving question");
                        }
                    },
                    error: function(xhr, status, error) {
                        alert("An AJAX error occurred: " + status + " - " + error);
                    }
                });
            });
        });
    </script>

</body>
</html>
